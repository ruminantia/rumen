# External Volumes Guide

Rumen supports monitoring external Docker volumes for automated processing, enabling integration with other systems that generate content such as web scrapers, data pipelines, or other applications.

## Overview

External volumes allow you to:
- Monitor content from other Docker containers
- Process files generated by external systems
- Maintain separation between content sources
- Scale processing across multiple volumes

## Current External Volume: `pasture_pastures`

The system includes a pre-configured example for monitoring scraped news/web articles:

### Volume Configuration

**Docker Compose** (`docker-compose.yml`):
```yaml
volumes:
  pasture_pastures:
    external: true

services:
  rumen:
    volumes:
      - pasture_pastures:/app/pasture_pastures
```

**Folder Configuration** (`config/config.ini`):
```ini
[pasture_pastures]
folder_path = /app/pasture_pastures
enabled = true
system_prompt = You are a news and web content analyst. Analyze the provided content and extract key information, summarize main points, and provide context.
user_prompt_template = Please analyze this content: {content}
provider = gemini
model = gemini-2.5-flash-lite
temperature = 0.4
max_tokens = 2048
output_format = markdown
# output_directory = /app/bolus/pasture_pastures  # Uncomment to use custom output folder
```

## Setting Up External Volumes

### Step 1: Create the External Volume

```bash
# Create the Docker volume
docker volume create pasture_pastures

# Verify creation
docker volume ls | grep pasture_pastures
```

### Step 2: Update Docker Compose

Add the volume definition and mount point:

```yaml
services:
  rumen:
    volumes:
      - pasture_pastures:/app/pasture_pastures

volumes:
  pasture_pastures:
    external: true
```

### Step 3: Configure Folder Monitoring

Add a folder configuration section in `config/config.ini`:

```ini
[pasture_pastures]
folder_path = /app/pasture_pastures
enabled = true
system_prompt = Your custom system prompt
user_prompt_template = Your custom user prompt: {content}
provider = gemini
model = gemini-2.5-flash-lite
temperature = 0.4
max_tokens = 2048
output_format = markdown
```

### Step 4: Start Rumen

```bash
# Build and start with the external volume
./run-docker.sh start

# Verify volume mounting
docker exec rumen ls -la /app/pasture_pastures
```

## Volume Structure

### Recommended Directory Organization

For the `pasture_pastures` volume, use this recursive structure:

```
/app/pasture_pastures/
├── 2024/
│   ├── 01/          # January
│   │   ├── 15/      # 15th day
│   │   │   ├── feed_name_1/
│   │   │   │   ├── abc123.md
│   │   │   │   └── def456.md
│   │   │   └── feed_name_2/
│   │   │       └── ghi789.md
│   │   └── 20/
│   │       └── another_feed/
│   │           └── jkl012.md
│   └── 02/          # February
│       └── ...
└── 2025/
    └── ...
```

### File Naming Convention

- Use hash-based filenames to avoid conflicts
- Include source and timestamp information
- Use `.md` extension for markdown content
- Ensure unique identifiers for tracking

## Adding Content to External Volumes

### Method 1: Using Temporary Containers

```bash
# Add files using a temporary Alpine container
docker run -it --rm \
  -v pasture_pastures:/data \
  alpine sh

# Inside container:
mkdir -p /data/2024/01/15/news_feed
echo "# Sample Article" > /data/2024/01/15/news_feed/sample.md
exit
```

### Method 2: Direct File Operations (Development)

```bash
# For development, you can use bind mounts temporarily
# Update docker-compose.yml:
volumes:
  - ./pasture_data:/app/pasture_pastures
```

### Method 3: Programmatic Access

If you have another service writing to the volume, mount it in that service's configuration:

```yaml
services:
  your_scraper_service:
    volumes:
      - pasture_pastures:/output/path
    # ... other configuration
```

## Multiple External Volumes

You can monitor multiple external volumes simultaneously:

### Example: Multiple Content Sources

**Docker Compose:**
```yaml
services:
  rumen:
    volumes:
      - news_articles:/app/news
      - research_papers:/app/research
      - social_media:/app/social

volumes:
  news_articles:
    external: true
  research_papers:
    external: true
  social_media:
    external: true
```

**Configuration:**
```ini
[news_articles]
folder_path = /app/news
enabled = true
system_prompt = You are a news analyst...
user_prompt_template = Analyze this news: {content}

[research_papers]
folder_path = /app/research
enabled = true
system_prompt = You are a research analyst...
user_prompt_template = Analyze this research: {content}

[social_media]
folder_path = /app/social
enabled = true
system_prompt = You are a social media analyst...
user_prompt_template = Analyze this social content: {content}
```

## Best Practices

### 1. Volume Management

- **Create volumes before starting**: Ensure volumes exist before mounting
- **Monitor disk usage**: External volumes can grow large
- **Implement backups**: Important for production data
- **Clean up regularly**: Remove processed files or archive old content

### 2. Content Organization

- **Use structured directories**: Year/month/day/feed organization
- **Include metadata**: Source, timestamp, and content type in filenames
- **Standardize formats**: Consistent file naming and structure
- **Separate by content type**: Different volumes for different content sources

### 3. Performance Optimization

- **Batch processing**: Group related files together
- **Monitor rate limits**: Be aware of LLM API limitations
- **Use appropriate prompts**: Tailor prompts to content type
- **Optimize file sizes**: Balance content length with processing requirements

## Monitoring and Debugging

### Verification Commands

```bash
# Check volume exists
docker volume ls

# Verify volume mounting
docker inspect rumen | grep -A 10 Mounts

# Check content in volume
docker run --rm -v pasture_pastures:/data alpine ls -la /data

# Monitor processing
./run-docker.sh logs -f | grep pasture_pastures
```

### Common Issues and Solutions

**Volume Not Found:**
```bash
# Create the volume
docker volume create your_volume_name

# Verify in docker-compose
docker compose config
```

**Permission Issues:**
```bash
# Check container user
docker exec rumen whoami

# Verify file permissions in volume
docker run --rm -v pasture_pastures:/data alpine ls -la /data
```

**Files Not Processing:**
- Check folder is enabled in `config/config.ini`
- Verify file extensions (.md, .txt)
- Ensure files are not empty
- Check file stability timeout

## Example Use Cases

### News Aggregation Pipeline

```ini
[news_pipeline]
folder_path = /app/news_volume
enabled = true
system_prompt = You are a news aggregation analyst. Extract key facts, summarize main points, and categorize content.
user_prompt_template = Process this news content: {content}
provider = gemini
temperature = 0.3
max_tokens = 1024
output_format = markdown
output_directory = /app/bolus/news
```

### Research Paper Processing

```ini
[research_processor]
folder_path = /app/research_volume
enabled = true
system_prompt = You are a research paper analyst. Extract methodology, key findings, limitations, and contributions.
user_prompt_template = Analyze this research paper: {content}
provider = openai
temperature = 0.5
max_tokens = 2048
output_format = markdown
output_directory = /app/bolus/research
```

### Social Media Analysis

```ini
[social_analyst]
folder_path = /app/social_volume
enabled = true
system_prompt = You are a social media analyst. Identify trends, sentiment, key topics, and influential content.
user_prompt_template = Analyze this social media content: {content}
provider = deepseek
temperature = 0.4
max_tokens = 512
output_format = markdown
output_directory = /app/bolus/social
```

## Security Considerations

- **Volume isolation**: External volumes provide content separation
- **Access control**: Limit which services can write to volumes
- **Content validation**: Implement checks for incoming content
- **Monitoring**: Log volume access and processing activities

## Next Steps

- [Configuration Guide](configuration.md) - Main configuration options
- [Folder Monitoring](folder-monitoring.md) - File processing setup
- [Prompt Management](prompt-management.md) - Advanced prompt configuration
- [API Reference](../api/overview.md) - HTTP API documentation
- [Troubleshooting](../advanced/troubleshooting.md) - Common issues and solutions

---

*External volumes enable powerful integration scenarios. Start with the `pasture_pastures` example and expand to meet your specific needs.*